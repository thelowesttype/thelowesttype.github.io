+++
title = "Multi Robot Planning"
description = "Planning for one robot is just too bland. How about multiple robots?"
date = 2022-02-10T13:26:37Z
updated = 2022-02-10T13:26:37Z
draft = false
template = "blog/page.html"

[taxonomies]
authors = ["Saksham"]

[extra]
lead = 'Indulging in the beautiful field called multi-robot path planning using Private Obstacle Path Planning algorithm'
math = true
+++

So first let me lay the groundwork for what the problem is? And why and what I am trying to achieve here.
Let's start with why the hell I need to do all this?

> Any sufficiently advanced technology is indistinguishable from magic.
>
*- Arthur C. Clarke*

## Why?
So this was a brainchild of the [Flipkart grid Challenge](https://www.youtube.com/watch?v=p8RlPfKk0EE&feature=youtu.be) competition, where we were supposed to deliver packages to multiple stations. We could use any number of robots we want and hence this raised the need to be able to plan in multiagent fashion.
<br>

## What was I trying to achieve?
So my aim in the team was to come up with a planning method which will be able to coordinate between all the different robots such that they don't collide. Now this needs to happen keeping in mind that overall performance of the robot should be maximized.
<br>
    <div style="text-align: center;">
        <figure>
            <img src="/blog/multi-robo/multiple-robo.png" style="width: 100%"></img>
            <figcaption> Multiple Mobile Robots, Path Planning and Motion Coordination </figcaption>
        </figure>
    </div>
<br>
Solving this problem can be divided into 2 broad categories: coupled approach and decoupled approach. This division is broadly based on the computational requirement and optimality of the solution generated by the method. In multi-agent problems one needs to achieve optimal balance between achieving computational complexity and optimality of the solution.
<br>
For this reason I wished to go with the decoupled approach. It’s way less taxing on the computation side and should give an optimized path.
<br>

## Defining the Problem Statement
The following was how the arena given to us looked like. The black regions are obstacles and the small notches made at (1,5) and (1,10) are the starting positions. The white area is where the robots can move around. The goals (9 in total) are given in the middle of map as a group of 4 black boxes.
<br>
<div style="text-align: center;">
    <figure>
        <img src="/blog/multi-robo/simple1.jpg" style="width: 100%"></img>
        <figcaption>Arena for testing</figcaption>
    </figure>
</div>
<br>
For this problem statment, I had to make the following assumptions:
<br>
- Related to Agent
    - Start and goal configuration for each agent is clearly defined.
    - They move at constant speeds.
    - Their trajectory is followed closely with small error.
- Related to Environment
    - Environment (or the workspace) is fully observable.
    - Environment is a discrete space, which the agent can move only at fixed units of distance.
- Related to Execution
    - It’s a centralized execution system
    - Execution is done using a frame based system.

## Previous Work
Among the highly cited papers I found was one stuck out for the simplicity and the beauty, “A Distributed and Optimal Motion Planning Approach for Multiple Mobile Robots” written by Guo and Parke, 2002 [1]. They talk about an approach of using coordination diagrams to do collision checks and then maximize the performance attribute of all the robots by varying the velocity profile of the robots. This approach is quite straightforward but in the scenario I tried it in there were quite a lot of times the robots ended up in deadlock as it was not changing the path of the robots.

<br>
    <div style="text-align: center;">
        <figure>
            <img src="/blog/multi-robo/Multirobot - Parker(1).png" style="width: 100%"></img>
            <figcaption>Coordination diagram for three robots. </figcaption>
        </figure>
    </div>
<br>

<b>Going into more detail</b> we can define the solution, where each agent R<sup>i</sup>
charts a path
$$\tau:[0,1] \xrightarrow{} R_{s,free}^i $$
Coordination diagram is used to optimize the velocity of each agent,
$$ X = [0,1]^m $$
coordination diagram for <i>m</i> robots. When agent is at 0 its considered to be at its starting position and when it reaches 1, it has reached the goal. The objective can be then defined to reach to
$$ h(0,1) \xrightarrow{} X_{free} $$
where $$ X_{free}= X - X_{obs} $$
Based on the above explanation we can define global performance index to be:
$$
\tau = \beta_1\times max(T_1,T_2,...Tm) + \beta_2\times \sum_{i=1}^m T_{idleTime,i} $$
where, T<sub>i</sub> denotes time spent by each of the m agents to reach the goal, I<sub>idleTime,i</sub> denotes idle time for the robots and 	&beta;<sub>1</sub>, &beta;<sub>2</sub> are the weights.
<br>

<br>
    <div style="text-align: center;">
        <figure class="zoom-without-container" style="max-width: auto;">
            <img src="/blog/multi-robo/combined.png" style="width: 100%"></img>
            <figcaption>Simulation Results of Nomad 200 Robot</figcaption>
        </figure>
    </div>
<br>

<!-- <br>
    <div style="text-align: center;">
        <figure class="zoom-without-container" style="max-width: 1000px;">
        <div class="row" style="flex: min-content">
            <div class="column"  style="flex: min-content; padding-right: 0">
                    <img src="/blog/multi-robo/path.png" style="width: 100%"></img>
                    <figcaption>Path Planning of Robots</figcaption>
            </div>
            <div class="column" style="flex: min-content">
                    <img src="/blog/multi-robo/velocity.png" style="width: 107%; padding-right: 15px"></img>
                    <figcaption>Velocity Profile of Robots</figcaption>
            </div>
        </div>
        </figure>
    </div>
<br> -->

To solve this problem one use D<sup>*</sup> velocity planning, where the cost function would something like:
$$
f_v = \eta + \alpha_1d+\alpha_2t_{idleTime} + \alpha_3p
$$
where &eta; is some large value tending to &#8734;, t<sub>idleTime</sub> is the total idle time for all the m agents, d is euclidean distance from current position to the goal point, p is the penalty incurred when the agent has to stop and let other agent pass.
<br>


## Private Obsctacle Planning
In this method instead of trying to manipulate the velocity of the agents such that they don't collide, we try to *change their paths*. First each agent plans its path towards their goal locations independent of other robots. Then collision detection and interchange detection is done for each pair of robots. <i>Collision detection</i> can be defined as when R<sub>1</sub> is moving from (x<sub>1</sub>,y<sub>1</sub>) to a common location (x<sub>c</sub>,y<sub>c</sub>) while R<sub>2</sub> is also moving from (x<sub>2</sub>,y<sub>2</sub>) to the common location then its defined as collision. <i>Interchange detection</i> is the case when R<sub>1</sub> is going (x<sub>1</sub>,y<sub>1</sub>) &rarr; (x<sub>2</sub>,y<sub>2</sub>), but R<sub>2</sub>
is also going (x<sub>2</sub>,y<sub>2</sub>) &rarr; (x<sub>1</sub>,y<sub>1</sub>) even though they aren't at the same position at a singular point but this will also lead to a collision. This can also be thought of as a subset of the <i>Collision detection</i> where they collide at (x<sub>1.5</sub>,y<sub>1.5</sub>) considering R<sub>1</sub> R<sub>2</sub> are moving at constant speed. But as our assumption was that we have a discrete space we cant define x<sub>1.5</sub> hence the need to define <i>Interchange detection</i>.
<br>
    <div style="text-align: center;">
        <figure class="zoom-without-container" style="max-width: auto;">
            <img src="/blog/multi-robo/before_After.png" style="width: 100%"></img>
            <figcaption>Before and After Collision Avoider</figcaption>
        </figure>
    </div>
<br>
<p>
Once collisions are detected in accordance to priority order between different agents R<sub>1</sub>,...,R<sub>m</sub> we need to define <i>private obstacles</i> &omega;<sub>i</sub> which is are obstacles, local and private to R<sub>i</sub> agent. &omega;<sub>i</sub> depends on the priority order and collisions taking place between each agent R<sub>i</sub>.
<br>
    <div style="text-align: center;">
        <figure class="zoom-without-container" style="max-width: auto;">
            <img src="/blog/multi-robo/time.png" style="width: 100%"></img>
            <figcaption>Time Taken for Planning</figcaption>
        </figure>
    </div>
<br>
<p>
The time complexity of this problem is O(rn<sup>3</sup>), r is number of time slices, $n$ is number of edges in the system. From this we can observe it is faster method than <i>Coupled Path Planing</i> as it's reducing a high dimensional problem into one with much lower dimensional space. The only disadvantage with this method is that it doesn't consider the possibility of reducing speed or stopping agents at various time instants, hence the solution found might not be the most optimum one.

## Future Work
To further optimize the algorithm one can use randomize search technique (hill climbing) to evaluate the best possible priority order for a set of agents. Going into detail how one can do this is by first starting off with initial priority order scheme selected in such a way that the agent with the longest path is given higher priority, one with the shortest path is given the least priority. Then priority order is exchanged between two agents in the scheme. If the new scheme results in a solution with shorter overall path of the agents than the best one found so far, it continues with this new order.
Since hill-climbing has local min-mima problem, algorithm performs random restarts with different initial
orders of the agents to minimize this issue to the least this thus defines, another cycle of trial. Like this we will have <i>maxCycles</i> denoting how many of these cycles it need to perform before selecting the best solution between them. We also define <i>maxJumps</i> to limit the max time spent on each cycle.

## Up Next
In future I want to talk about how the algorithum is exactly working and try to quantize the results with different style and sized arena. Once the project is done will put all the documentation in the project section of the website.
<br>
    <div style="text-align: center;">
        <figure>
            <img src="/blog/multi-robo/teaser.png" style="width: 100%"></img>
            <figcaption>Teaser Image</figcaption>
        </figure>
    </div>
<br>
<p>

*Also fun-fact you can subscribe to the blog using RSS! For Firefox users you can use [Livemark](https://addons.mozilla.org/en-US/firefox/addon/livemarks/?utm_source=addons.mozilla.org&utm_medium=referral&utm_content=search) for this.*

<span style="color:green">$</span> press <kbd>CTRL</kbd>+<kbd>W</kbd> to end the session.

---
<!-- Note: There must be a blank line between every two lines of the footnote difinition.  -->
[1] Yi Guo and L. E. Parker, "A distributed and optimal motion planning approach for multiple mobile robots," Proceedings 2002 IEEE International Conference on Robotics and Automation (Cat. No.02CH37292), 2002, pp. 2612-2619 vol.3, doi: 10.1109/ROBOT.2002.1013625.

[2] Lumelsky V.J., Harinarayan K.R. (1997) Decentralized Motion Planning for Multiple Mobile Robots: The Cocktail Party Model. In: Arkin R.C., Bekey G.A. (eds) Robot Colonies. Springer, Boston, MA. doi:  10.1007/978-1-4757-6451-2_7

[3] Parker L.E. (2009) Multiple Mobile Robot Teams, Path Planning and Motion Coordination in. In: Meyers R. (eds) Encyclopedia of Complexity and Systems Science. Springer, New York, NY. doi: 10.1007/978-0-387-30440-3_344
